# 🎯 性能优化建议

本文档提供 DataAcquisition 系统的性能优化建议和最佳实践。

## 概览

本页聚焦性能调优与部署建议。完整导航见索引页。

## 采集参数调优

| 参数                | 推荐值    | 说明              |
| ------------------- | --------- | ----------------- |
| BatchSize           | 10-50     | 平衡延迟和吞吐量  |
| AcquisitionInterval | 100-500ms | 根据 PLC 性能调整 |
| HeartbeatInterval   | 5000ms    | 连接监控频率      |

### BatchSize 调优建议

- **小批量 (10-20)**: 适合对延迟敏感的场景，数据能够快速写入
- **中批量 (20-50)**: 平衡延迟和吞吐量，推荐默认值
- **大批量 (50+)**: 适合高吞吐量场景，但会增加延迟

### AcquisitionInterval 调优建议

- **高频采集 (100-200ms)**: 适合快速变化的信号
- **中频采集 (200-500ms)**: 适合大多数工业场景，推荐默认值
- **低频采集 (500ms+)**: 适合变化缓慢的传感器数据

## 存储优化

### Parquet 压缩

- **Snappy 压缩**: 使用 Snappy 压缩算法减少磁盘占用
- **压缩级别**: 系统默认使用压缩，可在配置中调整

### 重试策略

- **重试间隔**: RetryWorker 默认 5 秒，可根据网络状况调整
- **最大重试次数**: 默认 3 次，超过后记录错误日志
- **重试队列**: 失败的数据保留在 WAL 文件中，定期重试

### InfluxDB 优化

- **批量写入**: 使用批量写入 API，提高写入效率
- **写入批大小**: 建议批量大小在 1000-5000 之间
- **连接池**: 配置合适的连接池大小

## 系统资源优化

### 内存管理

- **队列大小**: 根据可用内存调整队列大小
- **缓存策略**: 合理使用缓存，避免内存溢出
- **对象池**: 重用对象，减少 GC 压力

### CPU 优化

- **并发采集**: 多 PLC 设备并发采集，充分利用 CPU
- **异步处理**: 使用异步 API，提高 CPU 利用率
- **批量处理**: 批量处理数据，减少 CPU 开销

### 网络优化

- **批量读取**: 使用批量读取减少网络往返
- **连接复用**: 复用 PLC 连接，减少连接开销
- **超时设置**: 合理设置网络超时，避免长时间等待

## 监控指标

定期监控以下关键指标：

- **采集延迟**: `data_acquisition_collection_latency_ms`
- **队列深度**: `data_acquisition_queue_depth`
- **写入延迟**: `data_acquisition_write_latency_ms`
- **错误率**: `data_acquisition_errors_total`

根据监控数据调整配置参数，优化系统性能。

## 部署建议

### 单机部署

- 适合小规模部署，单个 Edge Agent 采集多个 PLC
- 建议配置：4 核 CPU，8GB 内存，SSD 存储

### 分布式部署

- 适合大规模部署，多个 Edge Agent 分布式采集
- 每个 Edge Agent 负责部分 PLC，减轻单机压力
- 通过 Central API 统一管理和监控

## 下一步

性能优化完成后，建议继续深入学习：

- [文档索引](index.md)
- [核心模块文档](modules.md)
- [数据处理流程](data-flow.md)
